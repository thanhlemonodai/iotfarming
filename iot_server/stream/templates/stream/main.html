{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
    <link rel="stylesheet" href="{% static 'stream/style.css' %}">
    <link rel="stylesheet" href="{% static 'stream/iotFarmViewCss.css' %}">
    <link rel="stylesheet" href="{% static 'stream/buttonstyle.css' %}">

        <!-- Bootstrap CSS -->

    <title>Home Tomato</title>
</head>
<body>
    <input type="checkbox" id="nav-toggle">
    <div class="sidebar">
        <div class="sidebar-brand">
            <h2><span class="las la-carrot" style="font-size: 30px"></span><span>TOMATO</span></h2>
        </div>

        <div class="sidebar-menu">
            <ul>
                <li>
                    <label for="sidebar-menu-toggle">
                        <a href="{% url 'iot-home-dashboard' %}" class="active"><span class="las la-igloo"></span>
                            <span>Dashboard</span></a>
                    </label>
                </li>
                <li>
                    <a href="{% url 'iot-farm-view' %}" class="active"><span class="las la-warehouse"></span>
                    <span>Iot Farm</span></a>
                </li>
                <li>
                    <a href="{% url 'iot-project-view' %}" class="active"><span class="las la-clipboard-list"></span>
                    <span>Projects</span></a>
                </li>
                <li>
                    <a href="#" class="active"><span class="las la-shopping-bag"></span>
                    <span>Orders</span></a>
                </li>
                <li>
                    <a href="#" class="active"><span class="las la-receipt"></span>
                    <span>Inventory</span></a>
                </li>

                <li>
                    <a href="#" class="active"><span class="las la-clipboard-list"></span>
                    <span>Tasks</span></a>
                </li>

                <li>
                    <a href="{% url 'admin:index' %}" class="active"><span class="las la-circle"></span>
                    <span>Admin</span></a>
                </li>
            </ul>
        </div>
    </div>

    <div class="main-content">
        <header class="header-top">
            <div>
                <h2>
                <label for="nav-toggle">
                    <span class="las la-bars"></span>
                </label>
                Dashboard
            </h2>
            </div>


            <div class="search-wrapper">
                <span class="las la-search"></span>
                <input type="search" placeholder="Search here"/>
            </div>

            <div class="user-auth-status" style="display: none;border-radius: 10px; background: #5cb85c;">
                <h4 id="user-auth-status-text" style="color: white; margin: 3px">status</h4>
            </div>

            {% if user.is_authenticated %}
                <div class="user-wrapper">
                    <img src="{% static 'media/3.jpg' %}" width="30px" height="30px" style="border-radius: 15px;" alt="">
                    <div>
                        <h4>Tomato Farm</h4>
                        <small>Super admin</small>
                    </div>
                    <div class="logout">
                        <a href="{% url 'logout' %}">Logout</a>
                    </div>
                </div>


            {% else %}
                <div class="login">
                    <a href="{% url 'login' %}">Login</a>
                    <a href="{% url 'register' %}">Register</a>
                </div>
            {% endif %}

        </header>

        {% block main-of-iot-home-dashboard %}
        {% endblock %}

        {% block iot-farm-views %}
            <script>
    console.log("JFIWEQJFI")
    console.log("JFIWEQJFI")
    console.log(window.location.host)
    var usernameInput = document.querySelector('#username');
    //var btnJoin = document.querySelector('#btn-join');
    var isCreatedOffer = false;
    var isAnsweredsdp = false;
    var username;
    var pc = null;
    var websocket;
    var arrayOfBlobs = [];
    var iceSDP = {};
    var ndem = 0;
    const b64_string = "data:image/png;base64,"

    var video = document.getElementById("#video")
    var mimeCodec = ""

     async function webSocketOnMessage(event) {

        var text = await event['data'].text();

        console.log(b64_string + text);


        var canvas = document.getElementById('videoCanvas');
        var context = canvas.getContext('2d');
        var imageObj = new Image();
        imageObj.onload = function () {
            context.drawImage(imageObj, 0, 0, 640, 480);
        };
        imageObj.src = b64_string + text;





    }



   /***
    btnJoin.addEventListener('click', () => {
        username = usernameInput.value;

        console.log(username)
        if (username === '') {
            return;

        }
        usernameInput.value = '';
        usernameInput.disabled = true;
        usernameInput.getElementsByClassName.visibility = 'hidden';

        btnJoin.disabled = true;
        btnJoin.getElementsByClassName.visibility = 'hidden';

        var pathName = '/iot-farm/stream'

        var loc = window.location;
        var wsStart = 'ws://';

        if (loc.protocol === 'https:') {
            wsStart = 'wss://';
        }

        var endPoint = wsStart + loc.host + loc.pathname + pathName;

        console.log('EndPoint: ', endPoint);

        webSocket = new WebSocket(endPoint);


        webSocket.addEventListener('open', (e) => {
            console.log('Conection Opened!');
            // webSocket.send(JSON.stringify({
            //     message : "hello this is first from webRTC",
            //     type : "word",
            //     user : "webRTC",
            // }))
        });

        webSocket.addEventListener('message', webSocketOnMessage);





        webSocket.addEventListener('close', (e) => {
            console.log('Disconnected!');

        });
        webSocket.addEventListener('error', (e) => {
            console.log('Error Occurred!');
        });
    });
  **/


</script>
        {% endblock %}

        {% block projects %}
        {% endblock %}
    </div>

</body>

</html>